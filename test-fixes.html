<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fixes</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .upload-area { 
            border: 2px dashed #ccc; 
            padding: 40px; 
            text-align: center; 
            margin: 20px 0;
            cursor: pointer;
        }
        .upload-area.dragover { border-color: #007bff; background: #f0f8ff; }
        .file-list { margin: 20px 0; }
        .file-item { 
            padding: 10px; 
            border: 1px solid #ddd; 
            margin: 5px 0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .reverse-btn { 
            padding: 10px 20px; 
            background: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer; 
            margin: 10px 0;
        }
        .page-thumbnails-container { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 10px; 
            margin: 20px 0;
        }
        .page-thumbnail { 
            border: 1px solid #ddd; 
            padding: 10px; 
            text-align: center; 
            cursor: move;
        }
    </style>
    <script defer data-domain="luxpdf.com" src="https://plausible.io/js/script.file-downloads.hash.outbound-links.js"></script>
    <script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>
</head>
<body>
    <h1>Test Fixes</h1>
    
    <h2>Test 1: Drag and Drop Duplication Fix</h2>
    <div class="upload-area" id="upload-area">
        <p>Drag & Drop PDF Files Here</p>
        <input type="file" id="file-input" multiple accept=".pdf" style="display: none;">
    </div>
    <div class="file-list" id="file-list"></div>
    
    <h2>Test 2: Reverse Order Button Fix</h2>
    <button type="button" id="reverse-pages-btn" class="reverse-btn">
        <i class="fas fa-exchange-alt"></i>
        Reverse Order (Back to Front)
    </button>
    <div id="page-thumbnails" class="page-thumbnails-container" style="display: grid;">
        <!-- Test thumbnails -->
        <div class="page-thumbnail" data-original-page-index="0">Page 1</div>
        <div class="page-thumbnail" data-original-page-index="1">Page 2</div>
        <div class="page-thumbnail" data-original-page-index="2">Page 3</div>
        <div class="page-thumbnail" data-original-page-index="3">Page 4</div>
    </div>
    <p id="status">Current order: Page 1, Page 2, Page 3, Page 4</p>
    
    <script>
        class TestPDFConverter {
            constructor() {
                this.uploadedFiles = [];
                this.isReversed = false;
                this.setupDragAndDrop();
                this.bindEvents();
            }
            
            setupDragAndDrop() {
                const uploadArea = document.getElementById('upload-area');
                if (!uploadArea) return;

                // Remove existing event listeners to prevent duplicates
                const newUploadArea = uploadArea.cloneNode(true);
                uploadArea.parentNode.replaceChild(newUploadArea, uploadArea);

                // Re-add click handler for the new element
                newUploadArea.addEventListener('click', () => {
                    const fileInput = document.getElementById('file-input');
                    if (fileInput) fileInput.click();
                });

                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    newUploadArea.addEventListener(eventName, this.preventDefaults, false);
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    newUploadArea.addEventListener(eventName, () => {
                        newUploadArea.classList.add('dragover');
                    }, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    newUploadArea.addEventListener(eventName, () => {
                        newUploadArea.classList.remove('dragover');
                    }, false);
                });

                newUploadArea.addEventListener('drop', (e) => {
                    const files = e.dataTransfer.files;
                    this.handleFileSelect(files);
                }, false);
            }
            
            bindEvents() {
                const fileInput = document.getElementById('file-input');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        this.handleFileSelect(e.target.files);
                    });
                }
                
                const reverseBtn = document.getElementById('reverse-pages-btn');
                if (reverseBtn) {
                    reverseBtn.addEventListener('click', () => {
                        this.reversePageOrder();
                    });
                }
                
                // Show test thumbnails
                document.getElementById('page-thumbnails').style.display = 'grid';
            }
            
            preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            handleFileSelect(files) {
                console.log('handleFileSelect called with', files.length, 'files');
                Array.from(files).forEach(file => {
                    // Check if file already exists to prevent duplicates
                    const existingFile = this.uploadedFiles.find(f =>
                        f.name === file.name && f.size === file.size && f.lastModified === file.lastModified
                    );

                    if (!existingFile) {
                        this.uploadedFiles.push(file);
                        this.addFileToList(file);
                        console.log('Added file:', file.name);
                    } else {
                        console.log('Duplicate file ignored:', file.name);
                    }
                });
            }
            
            addFileToList(file) {
                const fileList = document.getElementById('file-list');
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name} (${this.formatFileSize(file.size)})</span>
                    <button onclick="testConverter.removeFile('${file.name}', ${file.size}, ${file.lastModified})">Remove</button>
                `;
                fileList.appendChild(fileItem);
            }
            
            removeFile(fileName, fileSize, lastModified) {
                this.uploadedFiles = this.uploadedFiles.filter(file =>
                    !(file.name === fileName && file.size === fileSize && file.lastModified === lastModified)
                );
                this.updateFileList();
            }
            
            updateFileList() {
                const fileList = document.getElementById('file-list');
                fileList.innerHTML = '';
                this.uploadedFiles.forEach(file => this.addFileToList(file));
            }
            
            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            reversePageOrder() {
                const thumbnailContainer = document.getElementById('page-thumbnails');
                const reverseBtn = document.getElementById('reverse-pages-btn');
                const status = document.getElementById('status');
                if (!thumbnailContainer || !reverseBtn) return;

                const thumbnails = Array.from(thumbnailContainer.querySelectorAll('.page-thumbnail'));
                if (thumbnails.length === 0) return;

                // Clear container
                thumbnailContainer.innerHTML = '';

                // Add thumbnails in reverse order
                thumbnails.reverse().forEach(thumbnail => {
                    thumbnailContainer.appendChild(thumbnail);
                });

                // Toggle the reversed state
                this.isReversed = !this.isReversed;

                // Update button text and icon based on current state
                if (this.isReversed) {
                    reverseBtn.innerHTML = '<i class="fas fa-exchange-alt"></i> Reverse Order (Front to Back)';
                    status.textContent = 'Current order: Page 4, Page 3, Page 2, Page 1 (REVERSED)';
                    console.log('Pages reversed to Back to Front! Click again to restore Front to Back order.');
                } else {
                    reverseBtn.innerHTML = '<i class="fas fa-exchange-alt"></i> Reverse Order (Back to Front)';
                    status.textContent = 'Current order: Page 1, Page 2, Page 3, Page 4 (NORMAL)';
                    console.log('Pages restored to Front to Back order! Click again to reverse to Back to Front.');
                }
            }
        }
        
        const testConverter = new TestPDFConverter();
    </script>
</body>
</html>